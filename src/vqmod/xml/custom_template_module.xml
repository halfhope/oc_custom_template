<?xml version="1.0" encoding="UTF-8"?>
<modification>
	<id>Custom Templates module</id>
	<version>1.0</version>
	<vqmver>2.4.1</vqmver>
	<author>Shashakhmetov Talgat[talgatks@gmail.com]</author>
	<file name="catalog/controller/product/category.php">
		<operation error="log">
			<search position="replace"><![CDATA[$this->template = 'default/template/product/category.tpl';]]></search>
			<add><![CDATA[$this->template = 'default/template/product/category.tpl';
			}

			// Custom template module
			$this->load->model('setting/setting');

			$custom_template_module = $this->model_setting_setting->getSetting('custom_template_module');
			
			if(!empty($custom_template_module['custom_template_module'])){
				foreach ($custom_template_module['custom_template_module'] as $key => $module) {
					if (($module['type'] == 0) && !empty($module['categories'])) {
						if (in_array($category_id, $module['categories'])) {
							if (file_exists(DIR_TEMPLATE . $this->config->get('config_template') .DIRECTORY_SEPARATOR. $module['template_name'])) {
								$this->template = $this->config->get('config_template') .DIRECTORY_SEPARATOR. $module['template_name'];
							} else {
								$this->template = DIR_TEMPLATE . 'default' .DIRECTORY_SEPARATOR. $module['template_name'];
							}	
						}
					}
				}
			// Custom template module
			]]></add>
		</operation>
	</file>
	<file name="catalog/controller/product/product.php">
		<operation error="log">
			<search position="replace"><![CDATA[$this->template = 'default/template/product/product.tpl';]]></search>
			<add><![CDATA[
			}

			// Custom template module
			$this->load->model('setting/setting');

			$custom_template_module = $this->model_setting_setting->getSetting('custom_template_module');
			if(!empty($custom_template_module['custom_template_module'])){
				if(isset($this->request->get['path'])){
					foreach ($custom_template_module['custom_template_module'] as $key => $module) {
						if (($module['type'] == 4) && !empty($module['product_categories'])) {
							$category_id = explode('_', $this->request->get['path']);
							$category_id = end($category_id);
							if (in_array($category_id, $module['product_categories'])) {
								if (file_exists(DIR_TEMPLATE . $this->config->get('config_template') .DIRECTORY_SEPARATOR. $module['template_name'])) {
									$this->template = $this->config->get('config_template') .DIRECTORY_SEPARATOR. $module['template_name'];
								} else {
									$this->template = DIR_TEMPLATE . 'default' .DIRECTORY_SEPARATOR. $module['template_name'];
								}	
							}
						}
					}
				}
				
				foreach ($custom_template_module['custom_template_module'] as $key => $module) {
					if (($module['type'] == 1) && !empty($module['products'])) {
						$products = explode(',', $module['products']);
						if (in_array($product_id, $products)) {
							if (file_exists(DIR_TEMPLATE . $this->config->get('config_template') .DIRECTORY_SEPARATOR. $module['template_name'])) {
								$this->template = $this->config->get('config_template') .DIRECTORY_SEPARATOR. $module['template_name'];
							} else {
								$this->template = DIR_TEMPLATE . 'default' .DIRECTORY_SEPARATOR. $module['template_name'];
							}	
						}
					}
				}
				
			// Custom template module
			]]></add>
		</operation>
	</file>
	<file name="catalog/controller/information/information.php">
		<operation error="log">
			<search position="replace"><![CDATA[$this->template = 'default/template/information/information.tpl';]]></search>
			<add><![CDATA[
			}

			// Custom template module
			$this->load->model('setting/setting');

			$custom_template_module = $this->model_setting_setting->getSetting('custom_template_module');
			if(!empty($custom_template_module['custom_template_module'])){
				foreach ($custom_template_module['custom_template_module'] as $key => $module) {
					if (($module['type'] == 2) && !empty($module['informations'])) {
						if (in_array($information_id, $module['informations'])) {
							if (file_exists(DIR_TEMPLATE . $this->config->get('config_template') .DIRECTORY_SEPARATOR. $module['template_name'])) {
								$this->template = $this->config->get('config_template') .DIRECTORY_SEPARATOR. $module['template_name'];
							} else {
								$this->template = DIR_TEMPLATE . 'default' .DIRECTORY_SEPARATOR. $module['template_name'];
							}	
						}
					}
				}
			// Custom template module
			]]></add>
		</operation>
	</file>
	<file name="catalog/controller/product/manufacturer.php">
		<operation error="log">
			<search position="after"><![CDATA[$this->template = 'default/template/product/manufacturer_info.tpl';]]></search>
			<add><![CDATA[
			}
			
			// Custom template module
			$this->load->model('setting/setting');

			$custom_template_module = $this->model_setting_setting->getSetting('custom_template_module');
			if(!empty($custom_template_module['custom_template_module'])){
				foreach ($custom_template_module['custom_template_module'] as $key => $module) {
					if (($module['type'] == 3) && !empty($module['manufacturers'])) {
						if (in_array($manufacturer_id, $module['manufacturers'])) {
							if (file_exists(DIR_TEMPLATE . $this->config->get('config_template') .DIRECTORY_SEPARATOR. $module['template_name'])) {
								$this->template = $this->config->get('config_template') .DIRECTORY_SEPARATOR. $module['template_name'];
							} else {
								$this->template = DIR_TEMPLATE . 'default' .DIRECTORY_SEPARATOR. $module['template_name'];
							}	
						}
					}
				}
			// Custom template module
			]]></add>
		</operation>
	</file>
	
</modification>
<!-- wr aith -->